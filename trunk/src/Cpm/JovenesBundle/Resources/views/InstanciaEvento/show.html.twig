{% extends 'CpmJovenesBundle:Layout:admin_layout.html.twig' %}

{% block title %}Instancia de evento{% endblock %}

{% block content %}

<script>
  $(document).ready(function() { pasar_asistencia(); });
</script>
<div class="left-panel">
	<table class="record_properties">
	    <tbody>
	        <tr>
	            <th>Evento</th>
	            <td>{{ entity.evento.titulo }}</td>
	        </tr>
	        <tr>
	            <th>Descripción</th>
	            <td>{{ entity.descripcion }}</td>
	        </tr>
	        <tr>
	            <th>Url</th>
	            <td>{{ entity.url }}</td>
	        </tr>
	        <tr>
	            <th>Lugar</th>
	            <td>{{ entity.lugar }}</td>
	        </tr>
	        <tr>
	            <th>Inicio</th>
	            <td>{{ entity.fechaInicio|date('d-m-Y H:i:s') }}</td>
	        </tr>
	        <tr>
	            <th>Fin</th>
	            <td>{{ entity.fechaFin|date('d-m-Y H:i:s') }}</td>
	        </tr>
	    </tbody>
	</table>

<ul class="record_actions">
    <li>
        <a href="{{ path('instancia') }}">
            Volver al listado
        </a>
    </li>
    <li>
        <a href="{{ path('instancia_edit', { 'id': entity.id }) }}">
            Editar
        </a>
    </li>
    <li>
        <form action="{{ path('instancia_delete', { 'id': entity.id }) }}" method="post"
        	onsubmit="return confirm('Esta seguro que desea eliminar la instancia del evento?')">
            {{ form_widget(delete_form) }}
            <button type="submit">Borrar</button>
        </form>
    </li>
</ul>

</div>

{# invitaciones enviadas para esta instancia del evento #}
{% set aceptaciones = 0 %}
{% set asistentes = 0 %}
{% set pendientes = 0 %}
{% set rechazadas = 0 %}

<div id='resumen-box'>
	<h4>Resumen:</h4>
	<ul class='listado-items' id="resumen">
	</ul>
</div>

<div style="clear:both">
	{% if entity.invitaciones | length > 0 %}
		<table class="records_properties" id="invitaciones">
		    <thead>
		    <tr class='table-options'>
		    	<td colspan="100%">
				<ul class="table-options" style="float:right">	
					<li><a href="#" class="yes icon" onclick="$('tr.aceptada').toggle(); return false;"  title="Mostrar/Ocultar aceptadas"> &nbsp;</a></li>
			    	<li><a href="#" class="no icon" onclick="$('tr.rechazada').toggle(); return false;"   title="Mostrar/Ocultar rechazadas"> &nbsp;</a></li>
			    	<li><a href="#" class="ns_nc icon" onclick="$('tr.pendiente').toggle(); return false;"  title="Mostrar/Ocultar pendientes"> &nbsp;</a></li>
			    	<li><a class="excel-icon icon" href="{{ path('instancia_export_to_excel', { 'id': entity.id }) }}" title="Exportar a Excel">&nbsp;</a></li>
			    </ul>
		    </tr>
		        <tr>
		            <th>Id</th>
		            <th>Fecha</th>
		            <th>Aceptada</th>
		            {% if entity.evento.pedirNumeroAsistentes %}
		            <th>Asistentes</th>
		            {% endif %}
		            {% if entity.evento.permitirSuplente %}
		            <th>Suplente</th>
		            {% endif %}
		            {% if entity.evento.ofrecerHospedaje %}
		            <th>Requiere hospedaje</th>
		            {% endif %}
		            {% if entity.evento.ofrecerViaje %}
		            <th>Requiere pasaje</th>
		            {% endif %}
		            {% if entity.evento.permitirObservaciones %}
		            <th>Observaciones</th>
		            {% endif %}	          
		            <th> Asistió </th>  	            	            	            
		            
		        </tr>
		    </thead>
		    <tbody>
	    	{% for inv in entity.invitaciones %}
		        <tr class="{% if inv.sinResponder %}pendiente{% elseif inv.aceptoInvitacion %}aceptada{%else%}rechazada{% endif %}" >
		            <td><a href="{{ path('invitaciones_edit',{id:inv.id}) }}">{{ inv.id }}</a></th>
		            <td>{{ inv.fechaCreacion|date('d-m-Y H:i:s') }}</th>
		            <td  class="{% if inv.sinResponder %} ns_nc {% elseif inv.aceptoInvitacion %}yes{% else %}no{% endif %}"
		            			{% if inv.sinResponder %} colspan="100%" {% endif %}></td>
		            {% if not inv.sinResponder %}
				            {% if inv.aceptoInvitacion %}
				            {% set aceptaciones = aceptaciones + 1 %}
				            	{% if entity.evento.pedirNumeroAsistentes %}
				            	{% set asistentes = asistentes + inv.numeroAsistentes %}
					            	<td>{{ inv.numeroAsistentes }}</td>
					            {% else %}
					            	{% set asistentes = asistentes + 1 %}	
					        	{% endif %}
					            {% if entity.evento.permitirSuplente %}
					            	<td>{{ inv.suplente }}</th>
					            {% endif %}
					            {% if entity.evento.ofrecerHospedaje %}
					            	<td class="{% if inv.solicitaHospedaje %}yes{% else %}no{% endif %}"></td>
					            {% endif %}
					            {% if entity.evento.ofrecerViaje %}
						            <td class="{% if inv.solicitaViaje %}yes{% else %}no{% endif %}"></td>
					            {% endif %}
					            {% if entity.evento.permitirObservaciones %}
					            	<td>{{ inv.observaciones }}</td>
					            {% endif %}	  
					            <td class="{% if inv.asistio %}yes{% else %}no{% endif %} col-asistencia">
					            	<input type="checkbox" name="asistencia" value="{{ path('invitaciones_set_single_asistencia', { 'id': inv.id }) }}" {% if inv.asistio %} checked{%endif%}>
					            	<div class="loading inline-loading"></div>
					            </td>
				            {% else %}
					            {% set rechazadas= rechazadas+1 %}	
					            <td colspan="100%" class="rechazada">  </td>
				            {% endif %}
				           
				        {% else %}
				        	{% set pendientes=pendientes+1 %}
				        	
				      {% endif %} {# inv.aceptoInvitacion #}      
				      
		        </tr>
		        {% endfor %}
		</table>
	{% endif %} {# invitaciones > 0 #}	
		<script>
		$("#resumen").html('<li>Invitaciones enviadas: <span class="status">{{ entity.invitaciones | length}}</span></li> \
		<li>Invitaciones aceptadas: <span class="status"> {{ aceptaciones }}</span> </li> \
		<li>Invitaciones pendientes: <span class="status">{{ pendientes }}</span> </li> \
		<li>Invitaciones rechazadas: <span class="status">{{ rechazadas }}</span> </li> \
		<li>Cantidad de asistenes confirmados: <span class="status">{{asistentes }}</span> </li>');
		</script>
</div>
{% endblock %}
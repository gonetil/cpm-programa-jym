{% extends 'CpmJovenesBundle:Layout:admin_layout.html.twig' %}
{% import "CpmJovenesBundle:Perfil:proyecto_box.macro.html.twig" as proyecto_box %}

{% block title %} Detalle del proyecto{% endblock %} 
{% block content %}
 
 	  	<div class="proyecto_box_admin">	    
		  	{% if ( entity.estadoActual) and (entity.estadoActual.estado >= constant('ESTADO_PRESENTADO')) %}
																	 
				<div class="download_link icon" title="Descargar archivo">
			    	<a href="{{ path('proyecto_descargar_presentacion',{ 'id' : entity.id}) }}" > 
			    	 	&nbsp;
			    	</a>
		    	</div> 
			{% endif %}
		  	
		    <h2 class="proyeto_title"> Proyecto: {{ entity.titulo }} </h2>
			{% set escuela = entity.escuela %}
	
			<h4 class="info_header extra_info"> <a href="#" onclick="$('.info_escuela').toggle(); return false;"> {{ proyecto_box.nombreEscuela(entity.escuela) }} </a></h4>
			<div class="info_escuela hidden extra_info">
				<p> Domicilio {{ escuela.domicilio }} CP {{escuela.codigoPostal }} </p> 
				<p> Localidad {{escuela.localidad.nombre }} , Distrito {{ escuela.localidad.distrito }} </p>
				<p> Región Educativa: {{ entity.escuela.localidad.distrito.region }} </p>
				<p> Tel. {{ escuela.telefono }} / Email {{ escuela.email }} </p>
				<p> Director: {{ escuela.director }} </p>
			</div> <!-- info_escuela -->
		
			<h4 class="info_header extra_info">
				<a href="#" onclick="$('.info_coordinador').toggle(); return false;";>
					Coordinador {{ entity.coordinador.nombre }} {{entity.coordinador.apellido}}
				</a>			
			</h4>
			<div class="info_coordinador hidden extra_info"> 
				<p>Email <a href="mailto:{{entity.coordinador.email}}">{{entity.coordinador.email}}</a></p>
				<p> DNI: {{ entity.coordinador.dni }}</p>
	        	<p>Teléfono {{ entity.coordinador.telefono }}</p>
				<p>Teléfono celular {{ entity.coordinador.telefonoCelular }}</p>
				<p>Domicilio {{ entity.coordinador.domicilio }}</p>
	        	<p>Código postal {{ entity.coordinador.codigoPostal }}</p>
	        	
			</div>	<!-- info_coordinador -->

			{% if entity.colaboradores | length > 0 %}
				<h4 class="info_header extra_info">
					<a href="#" onclick="$('ul.colaboradores').toggle(); return false;";>
						Colaboradores ({{ entity.colaboradores | length }})
					</a>
				</h4>
				<ul class="colaboradores hidden extra_info">
					{% for colaboradores in entity.colaboradores %}
						<li> {{colaboradores.nombre}} {{colaboradores.apellido}} &lt;<a href="mailto:{{colaboradores.email}}">{{colaboradores.email}}</a>&gt;</li>
					{% endfor %}
				</ul>
				
			{% endif %}
		
			<h4 class="info_header extra_info"> <a href="#" onclick="$('.info_proyecto').toggle(); return false;">Acerca del proyecto (tema, alumnos, impacto...) </a></h4>
			<div class="info_proyecto hidden extra_info">
				<ul>	
			    	<li>Primera vez del docente: {{ common.show_bool(entity.esPrimeraVezDocente) }}</li>
			    	<li>Primera vez de la escuela: {{ common.show_bool(entity.esPrimeraVezEscuela) }}</li>
			    	<li>Primera vez de los alumnos: {{ common.show_bool(entity.esPrimeraVezAlumnos) }}</li>
			    </ul>
						
			
				<p> Cantidad de alumnos que participan: {{ entity.nroAlumnos }} </p>
				 
				<p> Tema principal: {{ entity.temaPrincipal }} </p>
				<p>  Producción Final: {{ entity.produccionFinal }} </p>
				
				<h4>¿De qué trata el proyecto?</h4>
				<p>  {{ entity.deQueSeTrata }} </p>
				
				<h4>¿Cuál es el motivo de su realización?</h4>
				<p>  {{ entity.motivoRealizacion }} </p>
				
				<h4>¿Cuál es el impacto buscado?</h4>
				<p>  {{ entity.impactoBuscado }} </p>
				<p> &nbsp; </p>
			</div> <!-- info_proyecto -->
			
			
			{% if entity.requerimientosDeEdicion | length > 0 %}
				<h4 class="info_header extra_info"> 
						<a href="#" onclick="$('.info_edicion').toggle(); return false;">Requerimientos de Edición </a></h4>
				<div class="info_edicion hidden extra_info">
					<p> Cantidad de alumnos que participan: {{ entity.requerimientosDeEdicion }} </p>
				</div> <!-- info_edicion -->
			{% endif %}
			
			
			<ul class="record_actions">
			    <li>
			        <a href="{{ path('proyecto') }}">
			            Volver al listado
			        </a>
			    </li>
			    <li>
			        <a href="{{ path('proyecto_edit', { 'id': entity.id }) }}">
			            Modificar
			        </a>
			    </li>
			    <li>
			        <form action="{{ path('proyecto_delete', { 'id': entity.id }) }}" method="post"
			            onsubmit="return confirm('¿Está seguro que desea eliminar el proyecto?');">
			            {{ form_widget(delete_form) }}
			            <button type="submit">Eliminar</button>
			        </form>
			    </li>
			</ul>
				
	</div> <!-- proyecto_box_admin -->
	
	
	<div class="proyecto_right_box">
	
	<div class="estados_proyecto_box">
		<h3 class="info_header">Estado actual: {{ entity.estadoActual }}</h3>
		<h4 class="info_header">
			<a style="" href="#" onclick="$('.info_estados').toggle(); return false;" > <img src="/images/icons/slidedown.png"> Historial ({{ estados_anteriores | length }})</a> 
			<a style="float:right;" href="javascript:cambiar_estado();">Cambiar estado</a>								
		</h4>
	 		
	 		
	 		<div class="info_estados hidden extra_info">
				<ul class="estados_list">
				{% set first = true %}
				{% for estado in estados_anteriores %}
					<li> 
						<div class="undo_list">
						 	{{ estado.fecha|date('d-m-Y') }}
							{% if first %} {# solo se muestra el boton de borrar en el primer estado del listado #}
								<a onclick='confirmAndRelocate("¿Está seguro que desea cancelar este estado? Esta operación no se puede deshacer","{{ path('proyecto_rollback', { 'id': entity.id }) }}"); return false;' href="#"> Cancelar </a>
								{% set first = false %}
							{% endif %}
						 </div>	
						
						<p><strong>Estado: {{ estado }}  </strong>
						</p>
						<ul class="estado_more_info">
							{% if estado.archivo %} 
								<li> Archivo adjunto:
									<a href="{{ path('proyecto_descargar_archivo_viejo', { 'id': estado.id }) }}">
										 {{ estado.archivo }}
									</a>
								</li>
							 {% endif %}
							 {% if estado.valoracion %}
							 	<li> Valoración: <strong> {{estado.valoracion}}</strong></li>
							 {% endif %}
							<li>Observaciones: {{ estado.observaciones }} </li>
						</ul>
					</li>
				{% endfor %}
				</ul> 
				
				<div id="estado_proyecto_form">
					<form id="nuevo_estado_proyecto_form" action="{{ path('proyecto_cambiar_estado', { 'id' : entity.id }) }}" method="post" {{ form_enctype(estado_form) }} onsubmit="return validar_form_cambio_estado();">
						{{ form_row(estado_form.estado) }}
						<div id="archivo_presentacion">
							{{ form_row(estado_form.archivo) }}
						</div>
						<div id="valoracion">
							{{ form_row(estado_form.valoracion) }}
						</div>
						{{ form_rest(estado_form) }}
						<script> mostrar_campo_archivo(); </script>
					</form>
				</div>
			</div> <!-- info_estados -->
		</div> <!-- estados_proyecto_box -->	
			
			{% if entity.invitaciones | length > 0 %}
	<div class="invitaciones">
		<div class="minimizer" onclick="$('.invitaciones .listado-items').toggle();"> - </div>
		<div class="invitacion">	
		    	<div class="many-pending"></div> Invitaciones a eventos 
		 </div>   	
		<ul class="listado-items">
			{% for invitacion in entity.invitaciones %}
				<li class="actions">
					{{ invitacion.instanciaEvento.titulo }}
					<div class="status">
					{% if not invitacion.instanciaEvento.fue() %}
						
						{% if invitacion.estaPendiente %}
							<span class='pendiente with-operations'>Pendiente
							{% if invitacion.estaVigente %}
							<div class="ops">
								 <ul>
								  	<li><a href="{{path('abrir_invitacion', {id:invitacion.id,accion:'aceptar'})}}" class="actions resaltado">Confirmar</a></li>   
								 	<li><a href="{{path('invitaciones_edit', {id:invitacion.id })}}">Editar</a></li>
								 	<li><a href="{{path('abrir_invitacion', {id:invitacion.id, accion:'rechazar'})}}">Rechazar</a></li>
								 </ul>
								 </div>
							{% endif %}
							</span>
							
						{% else %}
							{% if invitacion.aceptoInvitacion %}
							<span class='aceptado with-operations'>Confirmado
								<div class="ops">
									<ul>
								{#	<a href="{{path('abrir_invitacion', {id:invitacion.id,accion:'aceptar'})}}">Modificar</a> #}
									<li><a href="{{path('invitaciones_edit', {id:invitacion.id })}}">Modificar</a></li>
									<li><a href="{{ path('abrir_invitacion', { 'id': invitacion.id, accion: 'rechazar' }) }}">Cancelar Asistencia</a></li>
									{% if invitacion.instanciaEvento.evento.solicitarListaInvitados %}
										<li><a href="{{ path('invitados_export_to_excel', { 'id': invitacion.id }) }}">Exportar lista de invitados</a></li>
									{% endif %}								
									
									<li> {{ common.SelectCambiarInvitacionDeInstancia(invitacion) }} </li>
								</div>	
							</span>
							{% else %}
								<span class='rechazado with-operations'>Rechazado
								<div class="ops">
									<ul>
									<li><a href="{{path('abrir_invitacion', {id:invitacion.id,accion:'aceptar'})}}">Aceptar Invitación</a></li>
									<li><a href="{{path('invitaciones_edit', {id:invitacion.id })}}">Editar</a></li>
									</ul>
								</div>	
								</span>
							{% endif %}
							
    					{% endif %}
    					
    				{% else %}
    					
    					<p class="mini-icon {% if invitacion.asistio %} yes" title="Asisitó" {% else %} no" title="No Asistió" {% endif %} style="background-position:right center; padding-right: 20px; height: auto;"> 
    						Cerrado	
    					</p>  
    						
					{% endif %}
					</div>
				</li>
			{%endfor %}
			</ul>
		</div>	<!-- invitaciones -->

	  {% endif %}	
	
	</div> <!-- proyecto_right_box -->

{% endblock %}
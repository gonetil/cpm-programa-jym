{% extends 'CpmJovenesBundle:Layout:admin_layout.html.twig' %}

{% block title %} Modificar proyecto {% endblock %}

{% block content %}

<script src="{{ asset('js/dynamic_forms.js') }}" type="text/javascript"></script>


<script type="text/javascript">

  var email; 
  var form;
   
  $(document).ready(function() {
  
  $(".quitar_colaborador").click(function(e) {
    e.preventDefault();
    var number = $(this).attr("ref");
    email = $("#cpm_jovenesbundle_proyectotype_colaboradores_"+number+"_email").val();    
    form = $("#form"+number);
   
    $("#dialog").dialog("open");
  });
  
    $("#dialog").dialog({
      autoOpen: false,
      modal: true,
      buttons : {
		        "Confirm" : function() {
		        		$.post("{{ path('proyecto_quitar_colaborador') }}", 
								{	
									id_proyecto : {{ entity.id }} ,
								 	email_colaborador : email 
								 } ,
							    function(result) {
							    if (result = "success") { 
							    		$(this).dialog("close");
							    		form.empty().html("Colaborador eliminado satisfactoriamente");
							    		$(this).dialog("close");
							    	} else { 
							    		$(this).dialog("close");
							    		alert('Error al quitar el colaborador');
									}
					   });
		      },
		        "Cancel" : function() {
		          $(this).dialog("close");
		      }
      }
    });
  });

  
</script>


<form action="{{ path('proyecto_update', { 'id': entity.id }) }}" method="post" {{ form_enctype(edit_form) }}>
    
    {{ form_row(edit_form.titulo) }}
	{{ form_row(edit_form.coordinador) }}
	
		<label class=" required">Colaboradores</label>
	    <a href="#" class="jslink" onclick="addDynamicForm('#cpm_jovenesbundle_proyectotype_colaboradores'); return false;">
            Agregar colaborador
    	</a>	
    
    <div id="cpm_jovenesbundle_proyectotype_colaboradores"	
					{% if entity.colaboradores | length > 0 %} 
					{# cuando ya habia colaboradores cargados, tengo que poner el template del form de colaboradores a mano... asco! #}
			data-prototype="&lt;div&gt;&lt;label class=&quot; required&quot;&gt;$$name$$&lt;/label&gt;&lt;div id=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$&quot;&gt;&lt;div&gt;&lt;label for=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_nombre&quot; class=&quot; required&quot;&gt;Nombre&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_nombre&quot; name=&quot;cpm_jovenesbundle_proyectotype[colaboradores][$$name$$][nombre]&quot; required=&quot;required&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_apellido&quot; class=&quot; required&quot;&gt;Apellido&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_apellido&quot; name=&quot;cpm_jovenesbundle_proyectotype[colaboradores][$$name$$][apellido]&quot; required=&quot;required&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_email&quot; class=&quot; required&quot;&gt;Email&lt;/label&gt;&lt;input type=&quot;email&quot; id=&quot;cpm_jovenesbundle_proyectotype_colaboradores_$$name$$_email&quot; name=&quot;cpm_jovenesbundle_proyectotype[colaboradores][$$name$$][email]&quot; required=&quot;required&quot; /&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"		
		{% endif %}  
		>
		  
	{% for form_colaborador in edit_form.colaboradores %}
		<div class='innerForm' id="form{{loop.index - 1}}">
		<a href="#" class='quitar_colaborador' ref="{{loop.index - 1}}"> Quitar </a>
		{{ form_row(form_colaborador.nombre ) }}
		{{ form_row(form_colaborador.apellido ) }}
		{{ form_row(form_colaborador.email ) }}
		</div>
	{% endfor %}
	
		
	</div>		
	
    
    {{ form_rest(edit_form) }}
    
    <p>
        <button type="submit">Modificar</button>
    </p>
</form>

<ul class="record_actions">
    <li>
        <a href="{{ path('proyecto') }}">
            Volver al listado
        </a>
    </li>
    <li>
        <form action="{{ path('proyecto_delete', { 'id': entity.id }) }}" method="post">
            {{ form_widget(delete_form) }}
            <button type="submit">Eliminar</button>
        </form>
        
        <div id="dialog" title="Se requiere confirmación">
  			¿está seguro que desea quitar el colaborador del proyecto? 
		</div>
    </li>
</ul>
{% endblock %}

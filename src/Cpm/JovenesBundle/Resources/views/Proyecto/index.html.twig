{% extends 'CpmJovenesBundle:Layout:admin_layout.html.twig' %}

{% import "CpmJovenesBundle:Perfil:proyecto_box.macro.html.twig" as proyecto_box %}
{% import "CpmJovenesBundle:Proyecto:filter_form.macro.html.twig" as filter_form %}

{% block title %} Listado de Proyectos {% endblock %}
{% block content %}

<script>
			$(document).ready(function() { 
					$('select.region-selector').change(buscar_distritos);
					$('select.distrito-selector').change(buscar_localidades);
					
					
					{% if distritos is defined %} 
						options = "{% for d in distritos %}<option value='{{d.id}}' {% if (form.vars.value.distrito is defined) and ( form.vars.value.distrito == d.id ) %} selected='selected'{% endif %}>{{d.nombre}}</option>{% endfor %}";
						$('select.distrito-selector').append(options);
					{% endif %}
					
					{% if localidades is defined %} 
						options = "{% for l in localidades %}<option value='{{l.id}}' {% if (form.vars.value.localidad is defined) and ( form.vars.value.localidad == l.id ) %} selected='selected'{% endif %}>{{l.nombre}}</option>{% endfor %}";
						$('select.localidad-selector').append(options);
					{% endif %}

					}) //document ready
			;
</script>
<div id="before_list">
		
		{{ filter_form.show(form) }}
		
		
		<div class="systats">
				<h4> Estad√≠sticas del Sistema </h4>
			  <ul>
			  <li> Cant. de proyectos: {{total_proyectos}}</li>
			  {% if total_proyectos > 0 %}
			    <li> % primera vez del docente: {{ 100 * total_PrimeraVezDocente / total_proyectos }}% ( {{total_PrimeraVezDocente}} )</li>
			  	<li> % primera vez de los alumnos: {{ 100 * total_PrimeraVezAlumnos / total_proyectos }}% ({{total_PrimeraVezAlumnos}})</li>
			  	<li> % primera vez de la escuela: {{100 * total_PrimeraVezEscuela / total_proyectos }}% ({{total_PrimeraVezEscuela}})</li>
			  {% endif %}
			    <li> Cantidad de coordinadores: {{ total_Coordinadores }} </li>	
			  </ul>
		</div>

</div>


<table class="records_list">
    <thead>
        <tr>
            <th>Id</th>
            <th>Titulo</th>
            <th>Escuela</th>
            <th>Coordinador</th>
            <th>Colaboradores</th>
            <th>Alumnos</ht>
            <th>Tema Principal</th>
            <th>Region</th>
            <th>Localidad (Distrito) </th> 
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
    	<tr> <td colspan="100%"> Cantidad de resultados: <strong> {{ entities | length }} </strong> </td> </tr>
    {% for entity in entities %}
        <tr>
            <td><a href="{{ path('proyecto_show', { 'id': entity.id }) }}">{{ entity.id }}</a></td>
            <td>{{ entity.titulo }}</td>
            <td class="{% if entity.esPrimeraVezEscuela %}primera_vez{% endif %}"</td>
            		{{ proyecto_box.nombreEscuela(entity.escuela)  }}
            
            <td class="{% if entity.esPrimeraVezDocente %}primera_vez{% endif %}">
            {{ entity.coordinador.nombre }} {{ entity.coordinador.apellido }} </td>
            
            <td>{{ entity.colaboradores | length }}</td>
            
            <td class="{% if entity.esPrimeraVezAlumnos %}primera_vez{% endif %}">
            {{ entity.nroAlumnos }}</td>
            <td>{{ entity.temaPrincipal }}</td>
            <td>{{ entity.escuela.localidad.distrito.region }}</td>
            <td>{{ entity.escuela.localidad }} ({{ entity.escuela.localidad.distrito }})</td>
            <td>
                <ul>
                    <li>
                        <a href="{{ path('proyecto_show', { 'id': entity.id }) }}">Ver</a>
                    </li>
                    <li>
                        <a href="{{ path('proyecto_edit', { 'id': entity.id }) }}">Modificar</a>
                    </li>
                </ul>
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<div class="llamada">
	<div class="primera_vez llamada"></div>
	<p> participa por primera vez </p>
</div>

<ul>
    <li>
        <a href="{{ path('proyecto_new') }}">
            Agregar proyecto
        </a>
    </li>
</ul>
{% endblock %}